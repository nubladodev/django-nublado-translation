# django-nublado-translation

**A simple, reliable model-field translation system for Django projects.**

## Overview
This app provides a lightweight system for translating model fields without adding bloat:
- There's no automatic field injection into source models.
- There's no Generic ForeignKey hacks.
- It's focused on simple, per-field translations.

Subclass two abstract models, specify the source model and the fields to translate, and youâ€™re done.

## What's included
- Abstract base models for model-field translation:
  - `TranslationSourceModel`: for a model that's to be translated.
  - `TranslationModel`: for a model that has the translations of specified fields from its related `TranslationSourceModel`,  and linked via foreign key.

- Managers for translations:
  - `TranslationSourceManager`: adds helpers for working with translations on the source model.

#### Guarantees
Through this basic two-model (source model, translation model) contract:
- A source object can have at most one translation per language.
- All translated fields that are unique on the source model are unique per language on the translation model.
- These constraints are enforced at the database level.

## Installation

```bash
pip install django-nublado-translation 
```

Add to `INSTALLED_APPS`

```python
INSTALLED_APPS = [
    ...,
    "django_nublado_translation",
]
```

## Abstract models

### `TranslationSourceModel`

An abstract base model for objects that can be translated.

#### Minimal example

```python
from django.db import models

from django_nublado_translation.models import TranslationSourceModel
from django_nublado_translation.managers import TranslationSourceManager


class Article(TranslationSourceModel):
    title = models.CharField(max_length=250)
    slug = models.SlugField(max_length=250, unique=True)
    content = models.TextField()
    
    objects = TranslationSourceManager()

```

#### Notes
 - Using `TranslationSourceManager` is optional, but recommended. It's also recommended to extend it for concrete classes that have app-specific translation requirements.

### `TranslationModel`

An abstract base model for the translation of a subclass of TranslationSourceModel.

A foreign key to the source model is automatically generated by the
metaclass. Its name and related name can be customized with the source_name
and translations_name attributes.

Subclasses must define:
- source_model: a subclass of TranslationSourceModel
- translation_fields

#### Minimal example

```python
from django_nublado_translation.models import TranslationModel

class ArticleTranslation(TranslationModel):
    source_model = Article
    translation_fields = [
        "title",
        "slug",
        "content",
    ]

article  = Article(title="Hello everybody", slug="hello-everybody", content="Hello, everybody.")
article.save()

article_translation_es = ArticleTranslation(
    source=article,
    language="es",
    title="Hola a todos",
    slug="hola-a-todos",
    content="Hola a todos.",
)
article_translation_es.save()

```

#### Notes

- The foreign key to the source model is generated automatically.
- `source_name` and `translations_name` may be overridden **before migration** to customize relation names.
- All invariants described in the **Guarantees** are enforced at the database level.

## Getting translations

### From the source model directly:

```python
article.get_translation("es")
article.get_current_translation()
```

#### Notes

- `get_translation(language)` returns the translation for the given language or None.
- `get_current_translation()` uses the currently active Django language.

### Using `TranslationSourceManager`

```python
# Prefetch all available translations for article.
Article.objects.prefetch_translations()

# prefetch_translations() returns a QuerySet.
Article.objects.prefetch_translations().filter(slug="source-article-slug")

# Filter translations using a translation-model queryset.
translation_qs =  ArticleTranslation.objects.filter(language="es")
Article.objects.prefetch_translations(queryset=translation_qs)
```

#### Notes

- The translation queryset can be freely customized.
- This is especially useful when subclassing managers that apply translation-model-specific filtering.

## App settings

The settings from this app can be accessed via:

```python
from django_nublado_translation.conf.app_settings import app_settings

# Example usage
print(app_settings.SOURCE_LANGUAGE)
```

### Available settings and default values
- `SOURCE_LANGUAGE`: By default, set to `django.config.settings.LANGUAGE_CODE`.

### Overriding settings

In your project's `settings.py`, define a dictionary named `DJANGO_NUBLADO_TRANSLATION`.

```python
DJANGO_NUBLADO_TRANSLATION = {
    "SOURCE_LANGUAGE": "en",
}
```

## Testing

```bash
pytest
```

#### Notes:
- Runs all tests for the app.
- Requires `pytest-django`.